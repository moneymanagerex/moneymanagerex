version: 1.3.3.{build}

pull_requests:
  do_not_increment_build_number: true

image: Visual Studio 2015
configuration: Release
platform:
  - Win32
  - x64

matrix:
  fast_finish: true

environment:
  # This Semantic Versioning represent version from the top
  major: 1
  minor: 3
  patch: 3

  wxwin: c:\projects\wxwidgets
  # GETTEXT library can be obtained normaly via official
  # https://www.gnu.org/software/gettext/
  # where is mentioned that for windows it can be downloaded from
  # https://mlocati.github.io/articles/gettext-iconv-windows.html

  # But for appveyor we need to install cygwin that contains
  # embeded GETTEXT library
  path: C:\cygwin64\bin;C:\cygwin\bin;%path%

build_script:
- if "%PLATFORM%" == "Win32" call "c:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\vcvarsall.bat"
- if "%PLATFORM%" == "x64" call "c:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\vcvarsall.bat" x64
# wxWidgets
- git clone https://github.com/wxWidgets/wxWidgets.git %WXWIN%
- cd %WXWIN%
- git checkout tags/v3.1.0
- cd build/msw
- nmake /f makefile.vc TARGET_CPU=%PLATFORM%
# MMEX
- cd %APPVEYOR_BUILD_FOLDER%
- git submodule update --init
- cmake -G "NMake Makefiles" -D ARG_VER_MAJOR=%major% -D ARG_VER_MINOR=%minor% -D ARG_VER_PATCH=%patch% .
- nmake /f Makefile TARGET_CPU=%PLATFORM%
- cpack .

after_build:
- if "%PLATFORM%" == "Win32" appveyor PushArtifact "mmex-%major%.%minor%.%patch%-win32.exe" -FileName "mmex-%major%.%minor%.%patch%-win32_build%appveyor_build_number%.exe
- if "%PLATFORM%" == "x64" appveyor PushArtifact "mmex-%major%.%minor%.%patch%-win64.exe" -FileName "mmex-%major%.%minor%.%patch%-win64_build%appveyor_build_number%.exe"