<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en"><head>
























  
  <meta content="text/html; charset=UTF-8" http-equiv="content-type"><title>UnQLite C/C++ API Reference - Extracting Data From the Database</title><!-- Copyright (C) 2013 Mrad Chems Eddine, Symisc Systems,http://www.symisc.net contact@symisc.net -->
  

  

  
  <link rel="stylesheet" href="symisc.css" type="text/css">

  
  <meta content="Symisc Systems - Mrad Chems Eddine &lt;chm@symisc.net&gt;" name="author">

  
  <meta content="http://unqlite.org/" name="description"></head><body>
<div style="width: 1092px;" id="main_div"><a href="http://unqlite.org/"><img style="border: 0px solid ; width: 170px; height: 70px;" alt="Symisc UnQLite" title="Symisc UnQLite" src="../images/symisc-unqlite.png"></a><br>
<div style="text-align: left; width: 1080px;" align="right">
<table style="text-align: left; width: 1075px; height: 41px;" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top; width: 709px; height: 45px;"><small style="color: black; font-family: Verdana;"><small><br>
An Embeddable NoSQL Database Engine<br>
      </small></small></td>
      <td style="vertical-align: top; width: 162px; height: 45px;"><br>
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="unqlite_db" data-size="large">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script></td>
      <td style="vertical-align: top; width: 176px; height: 45px;"><br>
      <a href="https://twitter.com/unqlite_db" class="twitter-follow-button" data-show-count="false" data-size="large">Follow
@unqlite_db</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script></td>
    </tr>
  </tbody>
</table>
</div>
<hr style="width: 100%; height: 2px;">
<ul id="nav">
  <li id="nav-1"><a href="../index.html">About</a></li>
  <li id="nav-8"><a href="../features.html">Distinctive Features<br>
    </a></li>
  <li id="nav-2"><a href="../intro.html">Getting Started<br>
    </a></li>
  <li id="nav-3"><a href="../c_api.html">Documentation<br>
    </a></li>
  <li id="nav-4"><a href="../downloads.html">Downloads<br>
    </a></li>
  <li id="nav-5"><a href="../licensing.html">License<br>
    </a></li>
  <li id="nav-6"><a href="../faq.html">FAQ<br>
    </a></li>
  <li id="nav-7"><a href="../support.html">Online Support<br>
    </a></li>
</ul>
<h1 style="font-family: Verdana;"><font style="font-size: 10pt;" size="2">UnQLite</font><small><small><b> C/C++ API Reference - Extracting Data From the Database</b></small></small><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">.</font></font></h1>


<div><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><b>Syntax</b></font></font><br>
<br>
<p style="margin-left: 1.25cm; margin-bottom: 0cm; font-family: Courier New;">
</p>



<div style="margin-left: 40px;"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><font color="#000000"><span style="font-family: Courier New;"><span style="color: blue;">int</span> <span style="font-weight: bold;">unqlite_kv_fetch_callback</span>(</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue;">unqlite</span> *pDb,</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&nbsp;&nbsp;&nbsp; &nbsp; <span style="color: blue;">const</span> <span style="color: blue;">void</span> *pKey,<span style="color: blue;">int</span> nKeyLen,</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&nbsp;&nbsp; &nbsp;&nbsp; <span style="color: blue;">int</span> (*xConsumer)(<span style="color: blue;">const</span> <span style="color: blue;">void</span> *pData,<span style="color: blue;">unsigned</span> <span style="color: blue;">int </span></span></font></font></font><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><font color="#000000"><span style="font-family: Courier New;">iDataLen</span></font></font></font><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><font color="#000000"><span style="font-family: Courier New;"><span style="color: blue;"></span>,<span style="color: blue;">void</span> *pUserData),</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue;">void</span> *pUserData</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&nbsp;);</span><br>
</font></font></font></div>

<p style="margin-bottom: 0cm; margin-left: 40px;"><font color="#000000"><font face="Verdana, sans-serif"><font size="2"><span lang="en-US"><span style="font-style: normal;"><span style="font-weight: normal;"><br>
</span></span></span></font></font></font></p>
<p style="margin-bottom: 0cm; margin-left: 40px;">
</p>
<p style="margin-bottom: 0cm; font-style: normal; font-weight: normal; margin-left: 40px;" lang="en-US">
<font color="#000000"><font face="Verdana, sans-serif"><font size="2">Fetch
a record from the database and invoke the supplied callback to consume its data.</font></font></font></p>



<p style="margin-bottom: 0cm; margin-left: 40px;"><font color="#000000"><font face="Verdana, sans-serif"><font size="2"><span lang="en-US"><span style="font-style: normal;"><span style="font-weight: normal;"><br>
</span></span></span></font></font></font></p>

<p><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><b>Description</b></font></font></p>
<span style="font-weight: bold;"><br>
</span>
<p style="margin-left: 1.25cm;"><font face="Verdana, sans-serif"><font style="font-size: 11pt;" size="2"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;"></span></font></font><a href="unqlite_compile.html"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;"></span></font></font></a><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-weight: normal;"> </span></font></font></font></font>
</p>
<p style="margin-bottom: 0cm; margin-left: 40px;">
</p>
<p style="margin-bottom: 0cm; font-style: normal; font-weight: normal; margin-left: 40px;" lang="en-US">
<font color="#000000"><font face="Verdana, sans-serif"><font size="2">This
is the recommended interface to use by clients for data extraction.
Rather than allocating a static or dynamic buffer (Inefficient
scenario for large data), the caller simply need to supply a consumer
callback which is responsible of consuming the record data perhaps
redirecting it (i.e. Record data) to its standard output (STDOUT),
disk file, connected peer and so forth (See example below).</font></font></font></p>

<p style="margin-bottom: 0cm; font-style: normal; font-weight: normal; margin-left: 40px;" lang="en-US">
<br>
</p>

<p style="margin-bottom: 0cm; font-style: normal; font-weight: normal; margin-left: 40px;" lang="en-US">
<font color="#000000"><font face="Verdana, sans-serif"><font size="2">Depending
on how large the extracted data, the callback may be invoked more
than once.</font></font></font></p>

<p style="margin-bottom: 0cm; font-style: normal; font-weight: normal;" lang="en-US">
</p>
<p style="margin-bottom: 0cm; font-style: normal; font-weight: normal;" lang="en-US"><font color="#000000"><font face="Verdana, sans-serif"><font size="2"> </font></font></font>
</p>

<p style="margin-left: 1.25cm;"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><font face="Verdana, sans-serif"><span style="font-style: normal;"><span style="font-weight: normal;"><br>
</span></span></font></font></font></p>




<p><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><b>Parameters</b></font></font></p>
<p><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><b><br>
</b></font></font></p>
<table style="width: 100%;" id="table_code" border="1" bordercolor="#000000" cellpadding="2" cellspacing="0"><tbody><tr valign="top"><td width="28%"><span style="font-weight: bold;"></span>
      <div style="margin-left: 40px;"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><b>pDb</b></font></font></font></div>
</td>
      <td width="72%">
      <p> <font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">A pointer to a unQLite <a href="unqlite_open.html">Database Handle</a>.</font></font></p>
      </td>
    </tr><tr><td style="vertical-align: top;">
      <div style="margin-left: 40px;"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><b>pKey</b></font></font></font></div>
</td>
      <td style="vertical-align: top;"><font face="Verdana, sans-serif"><font size="2"><font color="#000000"><span lang="en-US"><span style="font-style: normal;">Record key.</span></span></font></font></font>
      </td>
    </tr>
    <tr><td style="vertical-align: top;">
      <div style="margin-left: 40px;"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><b>nKeyLen</b></font></font></font></div>
</td>
      <td style="vertical-align: top;">
      <p style="font-weight: normal;"><font face="Verdana, sans-serif"><font size="2"><font color="#000000"><span lang="en-US"><span style="font-style: normal;"><span style="font-style: italic; font-weight: bold;">pKey</span> length. If the nKeyLen argument is less than zero, then <span style="font-style: italic; font-weight: bold;">pKey</span> is
read up to the first zero terminator. If nKeyLen is non-negative, then
it is the maximum number of bytes read from </span></span></font></font></font><font face="Verdana, sans-serif"><font size="2"><font color="#000000"><span lang="en-US"><span style="font-style: normal;"><span style="font-style: italic; font-weight: bold;">pKey</span></span></span></font></font></font><font face="Verdana, sans-serif"><font size="2"><font color="#000000"><span lang="en-US"><span style="font-style: normal;">. </span></span></font></font></font>
      </p>

</td>
    </tr><tr>
      <td style="vertical-align: top; font-family: Courier New; font-weight: bold;">
      <div style="margin-left: 40px;"><font style="font-size: 10pt;" size="2"><font color="#000000"><span style="color: blue;">int</span> (*xConsumer)(<br>
      <span style="color: blue;">&nbsp;&nbsp; const</span> <span style="color: blue;">void</span> *pData,<br>
      <span style="color: blue;">&nbsp;&nbsp; unsigned</span> <span style="color: blue;">int </span></font></font><font style="font-size: 10pt;" size="2"><font color="#000000">iDataLen</font></font><font style="font-size: 10pt;" size="2"><font color="#000000"><span style="color: blue;"></span>,<br>
      <span style="color: blue;">&nbsp;&nbsp; void</span> *pUserData<br>
)</font></font></div>
      </td>
      <td style="vertical-align: top;"><font face="Verdana, sans-serif"><font size="2"><font color="#000000"><span lang="en-US"><span style="font-style: normal;">Data Consumer callback. The callback must accept three arguments: </span></span></font></font></font>
      <p style="margin-bottom: 0cm; font-style: normal; font-weight: normal;" lang="en-US"><font color="#000000"><font face="Verdana, sans-serif"><font size="2"><font face="Verdana, sans-serif">The
first argument is a pointer to the extracted data chunk.</font></font></font></font></p>

      <p style="margin-bottom: 0cm; font-style: normal; font-weight: normal;" lang="en-US">
<font color="#000000"><font face="Verdana, sans-serif"><font size="2"><font face="Verdana, sans-serif">The
second argument is the length in bytes of the extracted chunk.<br>
</font></font></font></font></p>
      <p style="margin-bottom: 0cm; font-style: normal; font-weight: normal;" lang="en-US"><font color="#000000"><font face="Verdana, sans-serif"><font size="2"><font face="Verdana, sans-serif"> The last
argument is a copy of the pointer (callback private data) passed as
the fifth argument to this routine.</font></font></font></font></p>
      <font color="#000000"><font face="Verdana, sans-serif"><font size="2"><font face="Verdana, sans-serif">When
done, the callback must return </font><font style="font-family: Courier New;" face="Verdana, sans-serif"><b>UNQLITE_OK</b></font><font face="Verdana, sans-serif">.
But, if for some reason the callback wishes to abort processing and
thus to stop its invocation, it must return </font><font face="Verdana, sans-serif"><b><span style="font-family: Courier New;">UNQLITE_ABORT</span>
</b></font><font face="Verdana, sans-serif">instead.</font></font></font></font>
      <p style="margin-bottom: 0cm; font-style: normal; font-weight: normal;" lang="en-US">
      </p>

</td>
    </tr>
    <tr>
      <td style="vertical-align: top;">
      <div style="margin-left: 40px;"><font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><b>pUserData</b></font></font></font></div>
      </td>
      <td style="vertical-align: top;">
      <p><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2">Arbitrary user pointer which is forwarded verbatim by the
engine to the callback as its third argument.</font></font></p>
</td>
    </tr>


    
  </tbody>
</table>

<p><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><b><br>
</b></font></font></p>
<p><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><b>Return
value</b></font></font></p>

<p style="margin-left: 1.25cm; font-weight: normal;"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><br>
<b></b></font></font></p>
<div style="margin-left: 40px;"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><b style="font-family: Courier New;">UNQLITE_OK</b>
is returned on success. Any other return value indicates failure such as:</font></font></div>

<p style="margin-left: 1.25cm; font-weight: normal;">
</p>
<p style="font-weight: normal; margin-left: 40px;"><font face="Verdana, sans-serif"><font size="2"><font color="#000000"><span lang="en-US"><span style="font-style: normal;"><b></b></span></span></font></font></font></p><p style="font-weight: normal; margin-left: 40px;"><font face="Verdana, sans-serif"><font size="2"><font color="#000000"><span lang="en-US"><span style="font-style: normal;"><br>
</span></span></font></font></font></p>

<p style="font-weight: normal; margin-left: 40px;"><font face="Verdana, sans-serif"><font size="2"><font style="font-family: Courier New;" color="#000000"><span lang="en-US"><span style="font-style: normal;"><b>UNQLITE_NOTFOUND</b></span></span></font><font color="#000000"><span lang="en-US"><span style="font-style: normal;">:
Nonexistent record.</span></span></font></font></font></p>
<p style="font-weight: normal; margin-left: 40px;"><font face="Verdana, sans-serif"><font size="2"><font color="#000000"><span lang="en-US"><span style="font-style: normal;"><br>
</span></span></font></font></font></p>
<p style="font-weight: normal; margin-left: 40px;"><font face="Verdana, sans-serif"><font size="2"><font style="font-family: Courier New;" color="#000000"><span lang="en-US"><span style="font-style: normal;"><b>UNQLITE_BUSY</b></span></span></font><font color="#000000"><span lang="en-US"><span style="font-style: normal;">:
Another thread or process have an exclusive lock on the
database. In this case, the caller should wait until the lock holder
relinquish it.</span></span></font></font></font></p>


<p style="margin-bottom: 0cm; font-weight: normal; margin-left: 40px;"><font face="Verdana, sans-serif"><font color="#000000"><font size="2"><span lang="en-US"><span style="font-style: normal;"><b></b></span></span></font></font></font></p><p style="margin-bottom: 0cm; font-weight: normal; margin-left: 40px;"><br>
</p>

<p style="margin-bottom: 0cm; font-weight: normal; margin-left: 40px;"><font face="Verdana, sans-serif"><font style="font-family: Courier New;" color="#000000"><font size="2"><span lang="en-US"><span style="font-style: normal;"><b>UNQLITE_IOERR</b></span></span></font></font><font color="#000000"><font size="2"><span lang="en-US"><span style="font-style: normal;">:
OS specific error. </span></span></font></font></font><font style="font-family: Courier New;" face="Verdana, sans-serif"><font color="#000000"><font size="2"><span lang="en-US"><span style="font-style: normal;"></span></span></font></font></font><font face="Verdana, sans-serif"><font color="#000000"><font size="2"><span lang="en-US"></span></font></font></font></p>
<p style="margin-bottom: 0cm; font-weight: normal; margin-left: 40px;"><br>
<font face="Verdana, sans-serif"><font color="#000000"><font size="2"><span lang="en-US"><span style="font-style: normal;"></span></span></font></font></font></p>




<p style="margin-bottom: 0cm; font-weight: normal; margin-left: 40px;"><font face="Verdana, sans-serif"><font style="font-family: Courier New;" color="#000000"><font size="2"><span lang="en-US"><span style="font-style: normal;"><b>UNQLITE_NOMEM</b></span></span></font></font><font color="#000000"><font size="2"><span lang="en-US"><span style="font-style: normal;">:
Out of memory (An unlikely scenario).</span></span></font></font></font></p>
<p style="margin-bottom: 0cm; font-weight: normal; margin-left: 40px;"><br>
<font face="Verdana, sans-serif"><font color="#000000"><font size="2"><span lang="en-US"><span style="font-style: normal;"></span></span></font></font></font></p>
<p style="font-weight: normal; margin-left: 40px;"><font face="Verdana, sans-serif"><font size="2"><font style="font-family: Courier New;" color="#000000"><span lang="en-US"><span style="font-style: normal;"><b>UNQLITE_ABORT</b></span></span></font><font color="#000000"><span lang="en-US"><span style="font-style: normal;">: Client consumer callback request an operation abort.</span></span></font></font></font></p>



<p style="margin-bottom: 0cm; font-weight: normal; margin-left: 40px;"><br>
</p>

<p style="margin-bottom: 0cm; margin-left: 40px;"><font face="Verdana, sans-serif"><font color="#000000"><font size="2"><span lang="en-US"><span style="font-style: normal;"><span style="font-weight: normal;">For
a human-readable error message, you can extract the database error
log via <a style="font-family: Courier New;" href="unqlite_config.html">unqlite_config()</a> with a configuration verb set to
</span></span></span></font></font><font style="font-weight: bold;" color="#000000"><font face="Courier New, monospace"><font size="2"><span lang="en-US"><span style="font-style: normal;">UNQLITE_CONFIG_ERR_LOG</span></span></font></font></font><font color="#000000"><font face="Consolas, sans-serif"><font style="font-size: 9pt;" size="2"><span lang="en-US"><span style="font-style: normal;">.</span></span></font></font></font></font></p>

<font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><b><br>
Example<br>
<br>
</b></font></font>
<p style="margin-left: 1.25cm;"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><a href="http://unqlite.org/db/unqlite_kv_intro.c"><font face="Verdana, sans-serif"><span style="font-weight: normal;">Compile this C file</span></font></a><font face="Verdana, sans-serif"><span style="font-weight: normal;">
for a smart introduction to these interface.</span></font></font></font></p>
<p style="margin-left: 1.25cm;"><br>
<font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><font face="Verdana, sans-serif"><span style="font-weight: normal;"></span></font></font></font></p>
<font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><b>
</b></font></font>
<p style="margin-left: 1.25cm; font-weight: normal;">
</p>

<div style="text-align: left; margin-left: 68px; width: 910px;" id="code">
<p style="margin-bottom: 0cm; font-style: normal; font-weight: normal;" lang="en-US">
<small style="font-family: Courier New;"><span style="color: blue;">#include <span style="color: red;">&lt;unqlite.h&gt;</span></span></small></p>
<p style="margin-bottom: 0cm; font-style: normal; font-weight: normal;" lang="en-US"><small style="font-family: Courier New;"><span style="color: blue;"><span style="color: red;"><br>
</span></span></small></p>
<p style="margin-bottom: 0cm; font-style: normal; font-weight: normal;" lang="en-US"><font color="#000000"><font face="Courier New, monospace"><font size="2"><font color="#008000">/*
A consumer callback which redirect the record data to its standard
output (STDOUT) */</font></font></font></font></p>


<p style="margin-bottom: 0cm; font-style: normal; font-weight: normal;" lang="en-US">
<font color="#000000"><font face="Courier New, monospace"><font size="2"><font color="#0000ff">static</font><font color="#000000">
</font><font color="#0000ff">int</font><font color="#000000">
DataConsumerCallback1(</font><font color="#0000ff">const</font><font color="#000000">
</font><font color="#0000ff">void</font><font color="#000000">
*pOutput,</font><font color="#0000ff">unsigned</font><font color="#000000">
</font><font color="#0000ff">int</font><font color="#000000">
nOutputLen,</font><font color="#0000ff">void</font><font color="#000000">
*pUserData)</font></font></font></font></p>

<p style="margin-bottom: 0cm;"><font color="#000000"><font face="Courier New, monospace"><font size="2">{</font></font></font></p>

<p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp;
<font face="Courier New, monospace"><font size="2"><span style="color: red;">ssize_t</span> nWr;</font></font></font></p>

<p style="margin-bottom: 0cm;">&nbsp;&nbsp; <font face="Courier New, monospace"><font size="2">nWr
= write(STDOUT_FILENO,pOutput,nOutputLen);</font></font></p>

<p style="margin-bottom: 0cm;">&nbsp;&nbsp; <font color="#0000ff"><font face="Courier New, monospace"><font size="2">if</font></font></font><font color="#000000"><font face="Courier New, monospace"><font size="2">(
nWr &lt; 0 ){</font></font></font></p>

<p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp;&nbsp;&nbsp;
</font><font color="#008000"><font face="Courier New, monospace"><font size="2">/*
Abort processing */</font></font></font></p>

<p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp;&nbsp;&nbsp;
</font><font color="#0000ff"><font face="Courier New, monospace"><font size="2">return</font></font></font><font color="#000000"><font face="Courier New, monospace"><font size="2">
UNQLITE_ABORT;</font></font></font></p>

<p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp;&nbsp;
<font face="Courier New, monospace"><font size="2">}</font></font></font></p>

<p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp;&nbsp;
</font><font color="#008000"><font face="Courier New, monospace"><font size="2">/*
All done, data was redirected to STDOUT */</font></font></font></p>

<p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp;&nbsp;
</font><font color="#0000ff"><font face="Courier New, monospace"><font size="2">return</font></font></font><font color="#000000"><font face="Courier New, monospace"><font size="2">
UNQLITE_OK;</font></font></font></p>

<p style="margin-bottom: 0cm;"><font color="#000000"><font face="Courier New, monospace"><font size="2">}</font></font></font></p>
<p style="margin-bottom: 0cm;"><font color="#000000"><font face="Courier New, monospace"><font size="2"><br>
</font></font></font></p>


<p style="margin-bottom: 0cm; font-style: normal; font-weight: normal;" lang="en-US">
<font color="#000000"><font face="Courier New, monospace"><font size="2"><font color="#008000">/*
Another data consumer callback which redirect the record data to a
connected client */</font></font></font></font></p>

<p style="margin-bottom: 0cm; font-style: normal; font-weight: normal;" lang="en-US"><font color="#000000"><font face="Courier New, monospace"><font size="2"><font color="#0000ff">static</font>
<font color="#0000ff">int</font> DataConsumerCallback2(<font color="#0000ff">const</font>
<font color="#0000ff">void</font> *pOutput,<font color="#0000ff">unsigned</font>
<font color="#0000ff">int</font> nOutputLen,<font color="#0000ff">void</font>
*pUserData)</font></font></font></p>

<p style="margin-bottom: 0cm;"><font face="Courier New, monospace"><font size="2"><font color="#000000">{</font>
</font></font>
</p>

<p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp;
</font><font color="#ff0000"><font face="Courier New, monospace"><font size="2">conn_t</font></font></font><font color="#000000"><font face="Courier New, monospace"><font size="2">
*pConn = (</font></font></font><font color="#ff0000"><font face="Courier New, monospace"><font size="2">conn_t</font></font></font><font color="#000000"><font face="Courier New, monospace"><font size="2">
*)pUserData; </font></font></font><font color="#008000"><font face="Courier New, monospace"><font size="2">/*
Callback private data */</font></font></font></p>

<p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp;
<font face="Courier New, monospace"><font size="2"><span style="color: red;">ssize_t</span> nWr;</font></font></font></p>

<p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp; </font><font color="#008000"><font face="Courier New, monospace"><font size="2">/*
Send data to the peer */</font></font></font></p>

<p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp; <font face="Courier New, monospace"><font size="2">nWr
= write(pConn-&gt;cli_fd,pOutput,nOutputLen);</font></font></font></p>

<p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp; </font><font color="#0000ff"><font face="Courier New, monospace"><font size="2">if</font></font></font><font color="#000000"><font face="Courier New, monospace"><font size="2">(
nWr &lt; 0 ){</font></font></font></p>

<p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp;&nbsp;&nbsp;
</font><font color="#008000"><font face="Courier New, monospace"><font size="2">/*
Peer hangs on us, abort processing */</font></font></font></p>

<p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp;&nbsp;&nbsp;
</font><font color="#0000ff"><font face="Courier New, monospace"><font size="2">return</font></font></font><font color="#000000"><font face="Courier New, monospace"><font size="2">
UNQLITE_ABORT;</font></font></font></p>

<p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp; <font face="Courier New, monospace"><font size="2">}</font></font></font></p>

<p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp; </font><font color="#008000"><font face="Courier New, monospace"><font size="2">/*
All done, data is sent to the peer */</font></font></font></p>

<p style="margin-bottom: 0cm;"><font color="#000000">&nbsp;&nbsp;
</font><font color="#0000ff"><font face="Courier New, monospace"><font size="2">return</font></font></font><font color="#000000"><font face="Courier New, monospace"><font size="2">
UNQLITE_OK;</font></font></font></p>

<p style="margin-bottom: 0cm;"><font color="#000000"><font face="Courier New, monospace"><font size="2">}</font></font></font></p>
<p style="margin-bottom: 0cm;"><font color="#000000"><font face="Courier New, monospace"><font size="2"><br>
</font></font></font></p>

<font color="#000000"><font face="Courier New, monospace"><font size="2"><font color="#008000">/* Main */</font></font></font></font><br>
<font color="#000000"><font face="Courier New, monospace"><font size="2">{</font></font></font><small style="font-family: Courier New;"><span style="color: blue;"><br></span></small><small style="font-family: Courier New;"><span style="color: blue;">int</span> rc;<br>
<span style="color: blue;">unqlite</span> *pDb;<br><span style="color: blue;"></span><br>
</small><small style="font-family: Courier New;"><span style="color: green;">// Open our database;</span></small><br style="font-family: Courier New;">
<small><span style="font-family: Courier New;">rc = <a href="unqlite_open.html">unqlite_open</a>(&amp;pDb,<span style="color: red;">"test.db"</span>,UNQLITE_OPEN_READONLY</span></small><small><span style="font-family: Courier New;">|UNQLITE_OPEN_MMAP</span></small><small><span style="font-family: Courier New;">);<br>
<span style="color: blue;">if</span>( rc != UNQLITE_OK ){ <span style="color: blue;">return</span>; }<br>
</span></small><small style="font-family: Courier New;"><span style="color: green;"><br></span></small><small style="font-family: Courier New;"><span style="color: green;"><span style="color: black;"> </span></span></small><small style="font-family: Courier New;"><span style="color: green;"></span></small><small style="font-family: Courier New;"><span style="color: green;">//Fetch our records and invoke the supplied callbacks<br>
</span></small><small><span style="font-family: Courier New;">unqlite_kv_fetch_callback(&amp;pDb</span></small>,<small><span style="font-family: Courier New;"><span style="color: red;">"MyRecord"</span></span></small><small><span style="font-family: Courier New;">,-1,DataConsumerCallback1,NULL</span></small><font color="#000000"><font face="Courier New, monospace"><font size="2"><font color="#008000">/* Callback private data */</font></font></font></font><small><span style="font-family: Courier New;">);</span></small><br>
<br>
<small><span style="font-family: Courier New;">unqlite_kv_fetch_callback(&amp;pDb</span></small>,<small><span style="font-family: Courier New;"><span style="color: red;">"OtherRecord"</span></span></small><small><span style="font-family: Courier New;">,-1,DataConsumerCallback2,newConn(fd)</span></small><font color="#000000"><font face="Courier New, monospace"><font size="2"><font color="#008000">/* Callback private data */</font></font></font></font><small><span style="font-family: Courier New;">);<br>
<br>
</span></small>
<small style="font-family: Courier New;"><span style="color: green;"></span></small><small style="font-family: Courier New;"><span style="color: green;"><span style="color: black;"></span></span></small><small style="font-family: Courier New;"><span style="color: green;"><span style="color: black;"><span style="color: green;">//Close our database handle</span></span></span></small><br>
<small style="font-family: Courier New;"><span style="color: green;"><span style="color: black;"><a href="unqlite_close.html">unqlite_close</a>(pDb);<br>
}<span style="color: green;"></span><br style="font-family: Verdana;">
</span></span></small><br>
</div>
<p style="margin-left: 1.25cm; font-weight: normal;">
</p>

<p style="margin-left: 1.25cm; font-weight: normal;">
</p>

<p style="margin-left: 1.25cm; font-weight: normal;"><br>
<font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><span style="font-weight: bold;"></span></font></font></p>

<p style="margin-left: 1.25cm; font-weight: normal;">
</p>
<p style="margin-left: 1.25cm; font-weight: normal;">
</p>
<p style="margin-left: 1.25cm; font-weight: normal;">
</p>

<font color="#000000"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><font face="Verdana, sans-serif"><span style="font-weight: normal;"></span></font></font></font></font>
<p><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><b>See also<br>
</b></font></font></p>

<p><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><b><br>
</b></font></font></p>
<div style="margin-left: 40px;"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><a href="http://unqlite.org/db/unqlite_func_intro.c"><font face="Verdana, sans-serif"><span style="font-weight: normal;"></span></font></a><font face="Verdana, sans-serif"><span style="font-weight: normal;"><a href="unqlite_kv_fetch.html">unqlite_kv_fetch</a></span></font></font></font><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><font face="Verdana, sans-serif"><span style="font-weight: normal;"></span></font></font></font><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><font face="Verdana, sans-serif"><span style="font-weight: normal;"></span></font></font></font><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><font face="Verdana, sans-serif"><span style="font-weight: normal;"></span></font></font></font><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><font face="Verdana, sans-serif"><span style="font-weight: normal;">, <a href="unqlite_kv_append.html">unqlite_kv_append</a>, <a href="unqlite_kv_store.html">unqlite_kv_store</a>, <a href="unqlite_open.html">unqlite_open</a>, <a href="unqlite_close.html">unqlite_close</a>, <a href="unqlite_config.html">unqlite_config</a>.</span></font></font></font></div>
<p style="margin-left: 1.25cm;"><font face="Verdana, sans-serif"><font style="font-size: 10pt;" size="2"><font face="Verdana, sans-serif"><span style="font-weight: normal;"><br>
</span></font></font></font></p>


</div>
<hr style="width: 100%; height: 2px;">
<div style="text-align: right; margin-top: 0px; height: 91px;"><small><small><a href="http://www.symisc.net/"><img style="border: 0px solid ; width: 170px; height: 70px;" alt="Symisc Systems" src="../images/symisc.png"></a></small></small>
<div style="text-align: left; margin-top: 0px; height: 14px;"><small><small style="font-family: Verdana;">Copyright Â© <a href="http://www.symisc.net/">Symisc Systems</a></small></small><br>
</div>
</div>
</div>

</body></html>